// ============================================================================
// GTK CSS FUNCTIONS
// ============================================================================
// Wrapper functions to use GTK CSS functions in SCSS without conflicts
@use "sass:string";
@function gtkalpha($c, $a) { @return string.unquote("alpha(#{$c}, #{$a})"); }
@function gtkmix($c1, $c2, $r) { @return string.unquote("mix(#{$c1}, #{$c2}, #{$r})"); }
@function gtkshade($c, $s) { @return string.unquote("shade(#{$c}, #{$s})"); }

// ============================================================================
// VARIABLES
// ============================================================================

// Matugen GTK colors
$window_fg_color: #{"@window_fg_color"};
$window_bg_color: #{"@window_bg_color"};
$view_bg_color: #{"@view_bg_color"};
$view_fg_color: #{"@view_fg_color"};
$card_bg_color: #{"@card_bg_color"};
$popover_bg_color: #{"@popover_bg_color"};
$accent_color: #{"@accent_color"};
$accent_bg_color: #{"@accent_bg_color"};
$accent_fg_color: #{"@accent_fg_color"};
$error_color: #{"@error_color"};
$warning_color: #{"@warning_color"};
$success_color: #{"@success_color"};

// Bar element sizing - single source of truth
$bar-element-size: 1.2em;

// ============================================================================

window.control-center {
    background-color: rgba(0, 0, 0, 0.1);
    border-radius: 12px;
}

.control-center-box {
    border-radius: 12px;
    background: gtkalpha($window_bg_color, 0.3);
    width: 21.25rem; /* 340px / 16 = 21.25rem */
    padding: 0.9375rem; /* 15px / 16 = 0.9375rem */
    overflow: hidden;
}

.card {
    background: gtkalpha($card_bg_color, 0.6);
    border-radius: 0.5rem; /* 8px */
    overflow: hidden;
}

.card-padding {
    padding: 0.9375rem; /* 15px */
}


.caption-heading {
    font-size: 0.75rem;
    font-weight: 600;
    opacity: 0.6;
    letter-spacing: 0.02em;
}

.icon-container {
    pointer-events: none;
}

.button {
    margin: 0px;
}

label {
    padding: 0px;
    margin: 0px;
}

button {
    background: transparent;
    border: none;
    color: inherit;
    transition: all 150ms ease-out;
}

calendar button {
    color: inherit;
}

button:hover {
    background: gtkalpha($window_fg_color, 0.1);
}

button.active {
    background: gtkalpha($accent_bg_color, 0.2);
}

button:active {
    background: gtkalpha($window_fg_color, 0.15);
}

button:focus-visible {
    outline: 2px solid $accent_bg_color;
    outline-offset: 2px;
}

button.circular {
    border-radius: 50%;
    min-width: 2.5rem;
    min-height: 2.5rem;
    padding: 0;
}

scale {
  all: unset;
  min-height: 1.5rem;
  margin-left: 0;
  margin-right: 0;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0;
}

scale:focus-visible {
  outline: 2px solid $accent_bg_color;
  outline-offset: 2px;
  border-radius: 0.75rem;
}

scale trough {
  min-height: 1.5rem;
  border-radius: 0.75rem;
  background: gtkalpha($window_fg_color, 0.1);
  margin-left: 0;
  margin-right: 0;
  padding: 0;
}

scale highlight {
  min-height: 1.5rem;
  border-top-left-radius: 0.75rem;
  border-bottom-left-radius: 0.75rem;
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
  background: linear-gradient(90deg, $accent_bg_color, gtkshade($accent_bg_color, 1.2));
}

scale slider {
  min-width: 1.5rem;
  min-height: 1.5rem;
  border-radius: 50%;
  background: gtkmix($accent_bg_color, $window_fg_color, 0.95);
  box-shadow: 0 2px 8px gtkalpha($window_fg_color, 0.2);
}

.volume-icon,
.brightness-icon {
  margin-left: 0.5rem;
  font-size: 1.25rem;
}

.control-section {
    transition: all 200ms ease-in-out;
    max-width: 19.375rem; /* 310px / 16 */
}

.player-info {
    min-width: 0;
}

.control-section > image {
    margin: 0;
    padding: 0;
    border-radius: 0.5rem; /* 8px */
}

.player-info scrolledwindow {
    min-width: 0;
    overflow: hidden;
}

.player-info scrolledwindow > * {
    overflow: hidden;
}

.player-info scrolledwindow box {
    background-color: transparent;
}

.player-info scrolledwindow label {
    background-color: transparent;
}

.control-section image,
.control-section label {
    transition: opacity 200ms ease-in-out;
}

.album-cover-box {
    border-radius: 0.5rem; /* 8px */
    min-width: 52px;
    min-height: 52px;
    max-width: 52px;
    max-height: 52px;
    border: none;
    box-shadow: none;
}

.album-cover-box picture {
    min-width: 52px;
    min-height: 52px;
}

/* Bar styles - Apple-like */
window.bar {
    background-color: rgba(0, 0, 0, 0);
}

.bar-container {
    background: gtkalpha($window_bg_color, 0.3);
    padding: 0.3rem 0.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px gtkalpha($window_fg_color, 0.12);
}

.bar-button {
    padding: 0;
    border-radius: 0.375rem;
    margin: 0;
    min-width: 1.75rem;
    min-height: 1.75rem;
    transition: all 150ms ease-out;
    background: transparent;
    border: none;
}

.bar-button:hover {
    background: gtkalpha($window_fg_color, 0.1);
}

.bar-button:active {
    background: gtkalpha($window_fg_color, 0.15);
}

.bar-button.app-menu-button label {
    font-size: $bar-element-size;
    font-family: "JetBrainsMono Nerd Font Propo";
    padding: 0 0.2em;
    line-height: 1;
}

.bar-button.workspace {
    min-height: 1.625rem;
    padding: 0;
    margin: 0;
    border: none;
    border-radius: 0.5rem;
    transition: background 180ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
    background: transparent;
}

.bar-button.workspace:hover {
    background: gtkalpha($window_fg_color, 0.08);
}

.bar-button.workspace.active {
    background: gtkalpha($accent_bg_color, 0.2);
}

.bar-button.workspace.active:hover {
    background: gtkalpha($accent_bg_color, 0.25);
}

.bar-button.workspace .workspace-label,
.bar-button.workspace .workspace-label-with-icons {
    font-size: $bar-element-size;
    opacity: 0.8;
    font-family: "JetBrainsMono Nerd Font Propo";
    font-weight: 500;
    min-width: 0;
    min-height: 0;
    margin: 0 0.1875rem;
    padding: 0 0.2em;
    line-height: 1;
    background-color: transparent;
}

.bar-button.workspace:hover label {
    opacity: 0.9;
}

.bar-button.workspace.active label {
    opacity: 1;
}

.bar-button.tray-item {
    margin: 0;
    padding: 0.1rem;
    min-width: unset;
    min-height: unset;
}

.bar-center {
    padding: 0.25rem 0.625rem;
    border-radius: 0.25rem;
    background: transparent;
}

.bar-time {
    font-weight: 500;
    font-size: 0.8125rem;
    letter-spacing: -0.01em;
}

.bar-date {
    font-size: 0.75rem;
    opacity: 0.6;
    font-weight: 400;
    margin-right: 0.375rem;
}

.bar-system-tray {
    padding: 0.125rem 0;
    border-radius: 0.25rem;
    background: transparent;
}

.bar-icon {
    margin: 0;
    padding: 0 0.2em;
    font-size: $bar-element-size;
    font-family: "JetBrainsMono Nerd Font Propo";
    font-weight: 400;
    min-width: 0;
    min-height: 0;
    line-height: 1;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
}

// GTK icons in bar (system tray, control center toggle, etc.)
// Size set via set_pixel_size() in code, not CSS
.bar-button image {
    /* Pixel size set programmatically */
}

.control-center-toggle {
    font-family: "JetBrainsMono Nerd Font Propo";
    background: transparent;
}

.control-center-toggle:hover {
    background: gtkalpha($window_fg_color, 0.1);
}

.control-center-toggle.active {
    background: gtkalpha($window_fg_color, 0.15);
}

.control-center-toggle.active:hover {
    background: gtkalpha($window_fg_color, 0.2);
}

/* Remove default MenuButton styling */
menubutton.control-center-toggle {
    border: none;
    box-shadow: none;
    outline: none;
}

menubutton.control-center-toggle > button {
    border: none;
    box-shadow: none;
    outline: none;
    background: transparent;
    padding: 0.25rem;
}

menubutton.control-center-toggle > button:hover {
    background: gtkalpha($window_fg_color, 0.1);
}

menubutton.control-center-toggle > button:active {
    background: gtkalpha($window_fg_color, 0.15);
}

/* Remove default Popover styling */
#control-center {
    background: gtkalpha($window_bg_color, 0.3);
    border: none;
    box-shadow: none;
    padding: 0;
    margin: 0;
    border-radius: 12px;
}

#control-center > contents {
    border: none;
    box-shadow: none;
    padding: 0;
    margin: 0;
}

/* Tray menu window - same style as control center */
window.tray-menu-window {
    background-color: rgba(0, 0, 0, 0.1);
    border-radius: 12px;
}

.tray-menu-box {
    border-radius: 12px;
    background: gtkalpha($window_bg_color, 0.3);
    padding: 0.5rem;
}

.tray-menu-item {
    border-radius: 0.375rem;
    padding: 0.5rem 0.75rem;
    margin: 0.125rem 0;
    transition: all 150ms ease-out;
    background: transparent;
    border: none;
}

.tray-menu-item:hover {
    background: gtkalpha($window_fg_color, 0.1);
}

.tray-menu-item:active {
    background: gtkalpha($window_fg_color, 0.15);
}

.tray-menu-item.back-button {
    font-weight: 600;
    opacity: 0.9;
}

.tray-menu-separator {
    margin: 0.25rem 0;
    opacity: 0.2;
}

.shortcut-label {
    font-size: 0.75rem;
    opacity: 0.5;
    margin-left: 1rem;
}

.submenu-arrow {
    opacity: 0.5;
    margin-left: 0.5rem;
}

/* Disposition styling */
.tray-menu-item.disposition-alert {
    color: $error_color;
}

.tray-menu-item.disposition-warning {
    color: $warning_color;
}

.tray-menu-item.disposition-informative {
    color: $accent_color;
}

/* Tray PopoverMenu (GTK4 native popover) */
popover.tray-popover-menu {
    background: gtkalpha($window_bg_color, 0.3);
    border-radius: 12px;
    padding: 0.5rem;
}

popover.tray-popover-menu > contents {
    background: transparent;
}

popover.tray-popover-menu button {
    border-radius: 0.375rem;
    padding: 0.5rem 0.75rem;
    margin: 0.125rem 0;
    transition: all 150ms ease-out;
    background: transparent;
    border: none;
}

popover.tray-popover-menu button:hover {
    background: gtkalpha($window_fg_color, 0.1);
}

popover.tray-popover-menu button:active {
    background: gtkalpha($window_fg_color, 0.15);
}

// ============================================================================
// MEDIA PLAYER STYLES
// ============================================================================

// Blurred background for media player
.blurred-cover {
    opacity: 0.3;
    min-width: 100%;
    min-height: 100%;
    border-radius: 0.5rem;
}

// Container for Cava audio visualizer
.cava-container {
    min-width: 100%;
    min-height: 100%;
    border-radius: 0.5rem;

    cava {
        opacity: 0.1;
    }
}

// Player overlay UI
.player-ui {
    padding: 0.75rem;
}

// Cava widget
cava {
    min-width: 100px;
    min-height: 50px;
}

// ============================================================================
// WIFI & BLUETOOTH STYLES
// ============================================================================

// Revealer containers
.wifi-revealer,
.bluetooth-revealer {
    padding: 0.75rem;
    background: gtkalpha($card_bg_color, 0.3);
    border-radius: 0.5rem;
    margin-top: 0.5rem;
}

// Network/Device items
.network-item,
.bluetooth-item {
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    margin: 0.125rem 0;
    transition: all 150ms ease-out;
    background: transparent;
    border: none;
}

.network-item:hover,
.bluetooth-item:hover {
    background: gtkalpha($window_fg_color, 0.1);
}

.network-item.active,
.bluetooth-item.active {
    background: gtkalpha($accent_bg_color, 0.15);
}

// Section labels
.section-label {
    font-size: 0.75rem;
    font-weight: 600;
    opacity: 0.6;
    letter-spacing: 0.02em;
    margin: 0.5rem 0 0.25rem 0;
}

// Empty state label
.empty-label {
    font-size: 0.875rem;
    opacity: 0.5;
    padding: 1rem 0;
}

// Arrow indicator for expand/collapse
.arrow-indicator {
    transition: transform 200ms ease-out;
}

.arrow-down {
    transform: rotate(90deg);
}

// Expand button (for WiFi/Bluetooth headers)
.expand-button {
    background: transparent;
    border: none;
    transition: all 150ms ease-out;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
}

.expand-button:hover {
    background: gtkalpha($window_fg_color, 0.05);
}

// Control buttons container
.control-buttons {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

// Icon buttons (refresh, settings, scan)
.icon-button {
    padding: 0.375rem;
    border-radius: 0.375rem;
    background: transparent;
    border: none;
    transition: all 150ms ease-out;
}

.icon-button:hover {
    background: gtkalpha($window_fg_color, 0.1);
}

.icon-button:active {
    background: gtkalpha($window_fg_color, 0.15);
}

// Password dialog
.password-dialog {
    padding: 0.75rem;
    background: gtkalpha($card_bg_color, 0.5);
    border-radius: 0.5rem;
    margin-bottom: 0.5rem;
}

.dialog-title {
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
}

.password-input-box {
    background: gtkalpha($window_fg_color, 0.05);
    border-radius: 0.375rem;
    padding: 0.5rem;
}

.password-input-box entry {
    background: transparent;
    border: none;
}

// Error message
.error-message {
    color: $error_color;
    font-size: 0.75rem;
    margin-top: 0.25rem;
}

// Error caption (for inline errors)
.caption.error {
    color: $error_color;
}

// Connect/Cancel buttons
.connect-button {
    background: gtkalpha($accent_bg_color, 0.2);
}

.connect-button:hover {
    background: gtkalpha($accent_bg_color, 0.3);
}

.cancel-button {
    background: gtkalpha($window_fg_color, 0.1);
}

.cancel-button:hover {
    background: gtkalpha($window_fg_color, 0.15);
}

// Navigation button (WiFi/Bluetooth labels in QuickToggles)
.nav-label-button {
    background: transparent;
    border: none;
    padding: 0.25rem 0;
    border-radius: 0.375rem;
    transition: all 150ms ease-out;
}

.nav-label-button:hover {
    background: gtkalpha($window_fg_color, 0.05);
}

// Menu header (back button + title)
.menu-header {
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid gtkalpha($window_fg_color, 0.1);
}

.menu-title {
    font-size: 1rem;
    font-weight: 600;
}

// Networks/Devices list
.networks-list,
.devices-list {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
}

// Menu footer
.menu-footer {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid gtkalpha($window_fg_color, 0.1);
}

// Settings button
.settings-button {
    background: gtkalpha($card_bg_color, 0.5);
    border: none;
    padding: 0.625rem;
    border-radius: 0.375rem;
    transition: all 150ms ease-out;
}

.settings-button:hover {
    background: gtkalpha($accent_bg_color, 0.15);
}

// ================================================================================
// Notifications
// ================================================================================

// Date/time button active state (when notification center is open)
.date-time-button.active {
    background: gtkalpha($window_fg_color, 0.15);
}

// Notification center window
window.notification-center {
    background-color: rgba(0, 0, 0, 0.1);
    border-radius: 12px;
}

.notification-center-box {
    border-radius: 12px;
    background: gtkalpha($window_bg_color, 0.3);
    width: 21.25rem; /* 340px */
    min-height: 58em; /* Same as HyprPanel */
    padding: 0.9375rem; /* 15px - same as control-center */
    overflow: hidden;
}

// Header with page switcher
.notification-center-header {
    padding: 0.25rem;
    background: gtkalpha($window_fg_color, 0.05);
    border-radius: 0.375rem;
}

// Page switcher buttons
.page-button {
    padding: 0.5rem 1rem;
    border-radius: 0.25rem;
    background: transparent;
    border: none;
    transition: all 150ms ease-out;
}

.page-button:hover {
    background: gtkalpha($window_fg_color, 0.08);
}

.page-button.active {
    background: gtkalpha($accent_bg_color, 0.2);
}

// Time widget
.time-widget {
    padding: 1rem;
    text-align: center;
}

.time-label {
    font-size: 2rem;
    font-weight: 600;
}

.date-label {
    font-size: 0.875rem;
    opacity: 0.8;
}

// Calendar
calendar {
    border-radius: 0.5rem;
    padding: 0.5rem;
}

// Header personnalis√© du calendrier
.calendar-header {
    padding: 0.25rem;
    margin-bottom: 0.25rem;
}

.calendar-title {
    font-weight: 600;
    font-size: 1rem;
}

.calendar-nav-btn {
    border-radius: 0.375rem;
    padding: 0.25rem;
    min-width: 28px;
    min-height: 28px;

    &:hover {
        background: gtkalpha($window_fg_color, 0.1);
    }
}

// Weather widget
.weather-widget {
    padding: 1rem;
    background: gtkalpha($window_fg_color, 0.05);
    border-radius: 0.375rem;
}

// Notification item in history - follows network-item/bluetooth-item pattern
.notification-item-wrapper {
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    margin: 0.125rem 0;
    transition: all 150ms ease-out;
    background: transparent;
}

.notification-item-wrapper:hover {
    background: gtkalpha($window_fg_color, 0.1);
}

.notification-item-icon {
    min-width: 32px;
    min-height: 32px;
}

.notification-item-app-name {
    font-weight: 600;
    opacity: 0.6;
}

.notification-item-summary {
    font-weight: 500;
}

.notification-item-body {
    opacity: 0.7;
}

// Notification popup (floating toast) - single layer
window.notification-popup {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 0.5rem;
    padding: 0.75rem;
    min-width: 20rem;
    max-width: 22rem;

    &.urgency-critical {
        border-left: 2px solid $accent_bg_color;
    }
}

.notification-icon {
    min-width: 32px;
    min-height: 32px;
}

.notification-app-name {
    font-weight: 600;
    opacity: 0.6;
}

.notification-close {
    padding: 0.375rem;
    border-radius: 0.375rem;
    background: transparent;
    border: none;
    opacity: 0.5;
    transition: all 150ms ease-out;

    &:hover {
        opacity: 1;
        background: gtkalpha($window_fg_color, 0.1);
    }
}

.notification-summary {
    font-weight: 500;
}

.notification-body {
    opacity: 0.7;
}

.notification-actions {
    margin-top: 0.5rem;

    button {
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        background: gtkalpha($window_fg_color, 0.1);
        border: none;
        transition: all 150ms ease-out;

        &:hover {
            background: gtkalpha($window_fg_color, 0.15);
        }
    }
}

// Tab switcher for notification center
.tab-switcher {
    padding: 0;
    margin-bottom: 0.5rem;

    .tab-button {
        padding: 0.5rem 1rem;
        background: transparent;
        border: none;
        border-bottom: 2px solid transparent;
        border-radius: 0;
        transition: all 150ms ease-out;

        label {
            font-weight: 500;
            opacity: 0.6;
        }

        &:hover {
            label {
                opacity: 0.8;
            }
        }

        &.active {
            border-bottom-color: $accent_bg_color;

            label {
                opacity: 1;
                font-weight: 600;
            }
        }
    }
}

// Separator before clear all button
.notification-separator {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    min-height: 1px;
    background: gtkalpha($window_fg_color, 0.1);
}

// Clear all button - follows notification-close pattern (opacity-based)
.clear-all-button {
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    background: transparent;
    opacity: 0.6;
    transition: all 150ms ease-out;

    &:hover {
        opacity: 1;
    }
}

// Notification pagination - follows tab-switcher pattern (opacity + border-based)
.notification-pager {
    margin-top: 0.5rem;
    padding: 0.25rem;

    .pager-button {
        min-width: 2rem;
        min-height: 2rem;
        padding: 0.25rem 0.5rem;
        border-radius: 0;
        background: transparent;
        border-bottom: 2px solid transparent;
        transition: all 150ms ease-out;

        label {
            font-size: 0.875rem;
            opacity: 0.6;
        }

        &:hover {
            label {
                opacity: 0.8;
            }
        }

        &.active {
            border-bottom-color: $accent_bg_color;

            label {
                opacity: 1;
                font-weight: 600;
            }
        }

        &:disabled {
            opacity: 0.3;
        }
    }

    .pager-ellipsis {
        padding: 0.25rem 0.5rem;
        opacity: 0.5;
    }
}
